<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Guide: Handling Conflicts - 4Set System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="assets/js/tailwind.config.js"></script>
  <link rel="stylesheet" href="assets/css/theme_pantone_light_1.css">
  <link rel="stylesheet" href="assets/css/global.css">
  <link rel="stylesheet" href="assets/css/user-guides.css">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
  </style>
</head>
<body class="min-h-screen">
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <a href="index.html" class="text-2xl font-bold" style="color: var(--primary)">4Set System</a>
          <span class="text-gray-400">|</span>
          <h1 class="text-xl font-semibold text-gray-700">User Guide: Handling Data Conflicts</h1>
        </div>
        <div class="flex items-center gap-4">
          <a href="user_guide_checking_system.html" class="text-sm text-gray-600 hover:text-primary transition">Checking System</a>
          <a href="user_guide_uploader.html" class="text-sm text-gray-600 hover:text-primary transition">Uploader Guide</a>
          <a href="user_guide_qualtrics.html" class="text-sm text-gray-600 hover:text-primary transition">Qualtrics Guide</a>
        </div>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-6 py-8">
    <div class="flex gap-8">
      <aside class="sidebar w-64 flex-shrink-0">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-lg font-bold mb-4" style="color: var(--primary)">Table of Contents</h2>
          <nav class="space-y-2">
            <a href="#overview" class="toc-link block text-sm text-gray-700 py-1">Overview</a>
            <a href="#conflict-detection" class="toc-link block text-sm text-gray-700 py-1">Conflict Detection</a>
            <a href="#handling" class="toc-link block text-sm text-gray-700 py-1">Handling Conflicts</a>
            <a href="#scenarios" class="toc-link block text-sm text-gray-700 py-1">Common Scenarios</a>
            <a href="#best-practices" class="toc-link block text-sm text-gray-700 py-1">Best Practices</a>
          </nav>
        </div>
      </aside>

      <main class="flex-1 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
          <div class="mb-8 pb-6 border-b border-gray-200">
            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
              <div><strong>Version:</strong> 1.0</div>
              <div><strong>Last Updated:</strong> October 25, 2025</div>
              <div><strong>Target Audience:</strong> System Operators, Data Administrators</div>
            </div>
          </div>

          <section id="overview" class="content-section mb-12">
            <h2 class="text-3xl font-bold mb-6" style="color: var(--primary)">Overview</h2>
            
            <p class="text-gray-700 mb-6 text-lg leading-relaxed">
              The 4Set Processor Agent includes <strong>Data Overwrite Protection</strong> to prevent accidental corruption of existing assessment data.
            </p>

            <h3 class="text-2xl font-semibold mb-4">What Gets Protected?</h3>

            <div class="grid md:grid-cols-2 gap-6">
              <div class="diagram-box bg-green-50 border-green-300">
                <h4 class="font-semibold mb-3">✅ Protected Fields</h4>
                <p class="text-sm text-gray-700 mb-2">Cannot Overwrite:</p>
                <ul class="space-y-1 text-sm text-gray-700">
                  <li>• All assessment answers</li>
                  <li>• Demographic data (if filled)</li>
                  <li>• Any non-administrative field with data</li>
                </ul>
              </div>

              <div class="diagram-box bg-yellow-50 border-yellow-300">
                <h4 class="font-semibold mb-3">❌ Exception Fields</h4>
                <p class="text-sm text-gray-700 mb-2">Can Overwrite:</p>
                <ul class="space-y-1 text-sm text-gray-700">
                  <li>• student-id</li>
                  <li>• child-name</li>
                  <li>• school-id, district</li>
                  <li>• class-id, class-name</li>
                  <li>• computerno</li>
                </ul>
              </div>
            </div>
          </section>

          <section id="conflict-detection" class="content-section mb-12">
            <h2 class="text-3xl font-bold mb-6" style="color: var(--primary)">Conflict Detection</h2>

            <h3 class="text-2xl font-semibold mb-4">What Triggers a Conflict?</h3>
            
            <div class="diagram-box">
              <p class="text-gray-700 mb-3">A conflict is detected when:</p>
              <ol class="list-decimal ml-6 space-y-2 text-gray-700">
                <li>✅ An existing submission already exists (same sessionkey)</li>
                <li>✅ A protected field has a non-empty value in JotForm</li>
                <li>✅ The new PDF has a <strong>different</strong> non-empty value</li>
                <li>✅ The field is <strong>not</strong> in the exception list</li>
              </ol>
            </div>

            <h3 class="text-2xl font-semibold mb-4 mt-6">What Does NOT Trigger a Conflict?</h3>

            <div class="grid md:grid-cols-2 gap-4">
              <div class="diagram-box bg-gray-50 border-gray-300">
                <ul class="space-y-2 text-sm text-gray-700">
                  <li>❌ Inserting data into blank fields</li>
                  <li>❌ Same value (no change)</li>
                </ul>
              </div>
              <div class="diagram-box bg-gray-50 border-gray-300">
                <ul class="space-y-2 text-sm text-gray-700">
                  <li>❌ Null/empty new value</li>
                  <li>❌ Exception fields (admin data)</li>
                </ul>
              </div>
            </div>
          </section>

          <section id="handling" class="content-section mb-12">
            <h2 class="text-3xl font-bold mb-6" style="color: var(--primary)">Handling Conflicts</h2>

            <div class="space-y-6">
              <div class="diagram-box bg-blue-50 border-blue-300">
                <h3 class="text-xl font-semibold mb-4">Step 1: Identify Conflicted Files</h3>
                <p class="text-gray-700 mb-3">Conflicted files are automatically moved to the <code>Unsorted/</code> folder:</p>
                <pre class="text-xs">OneDrive/
└── 97 - Project RAW Data/
    └── PDF Form Data/
        └── Unsorted/
            ├── 12345_20250101_10_30.pdf
            └── 12345_20250101_10_30.json</pre>
              </div>

              <div class="diagram-box bg-purple-50 border-purple-300">
                <h3 class="text-xl font-semibold mb-4">Step 2: Review the Log</h3>
                <ol class="list-decimal ml-6 space-y-2 text-gray-700 text-sm">
                  <li>Open daily log: <code>logs/YYYYMMDD_processing_agent.csv</code></li>
                  <li>Search for <code>DATA_OVERWRITE_DIFF</code> entries</li>
                  <li>Review conflict details</li>
                </ol>
                <div class="bg-white rounded p-3 mt-3">
                  <p class="text-xs font-mono text-gray-700">Example: "ERV_Q1 (QID 30): existing='A' → new='B'"</p>
                </div>
              </div>

              <div class="diagram-box bg-green-50 border-green-300">
                <h3 class="text-xl font-semibold mb-4">Step 3: Investigate the Cause</h3>
                <p class="text-gray-700 mb-2">Ask yourself:</p>
                <ul class="list-disc ml-6 space-y-1 text-gray-700 text-sm">
                  <li>Is this a re-upload?</li>
                  <li>Is the existing data correct?</li>
                  <li>Is the new data correct?</li>
                  <li>Was there an administrative error?</li>
                </ul>
              </div>

              <div class="diagram-box bg-yellow-50 border-yellow-300">
                <h3 class="text-xl font-semibold mb-4">Step 4: Resolve the Conflict</h3>
                
                <div class="collapsible-section">
                  <div class="collapsible-header">
                    <h4 class="font-semibold">Option A: Keep Existing Data</h4>
                    <span class="text-xl">▼</span>
                  </div>
                  <div class="collapsible-content">
                    <p class="text-sm text-gray-700 mb-2">If the existing data is correct:</p>
                    <ol class="list-decimal ml-6 space-y-1 text-sm text-gray-700">
                      <li>Archive the conflicted PDF (move to backup folder)</li>
                      <li>Delete the JSON file from Unsorted/</li>
                      <li>No further action needed</li>
                    </ol>
                  </div>
                </div>

                <div class="collapsible-section">
                  <div class="collapsible-header">
                    <h4 class="font-semibold">Option B: Manually Update JotForm</h4>
                    <span class="text-xl">▼</span>
                  </div>
                  <div class="collapsible-content">
                    <p class="text-sm text-gray-700 mb-2">If the new data is correct:</p>
                    <ol class="list-decimal ml-6 space-y-1 text-sm text-gray-700">
                      <li>Log into JotForm</li>
                      <li>Search for the submission by sessionkey</li>
                      <li>Manually edit the submission</li>
                      <li>Document the change</li>
                      <li>Archive PDF and JSON from Unsorted/</li>
                    </ol>
                  </div>
                </div>

                <div class="collapsible-section">
                  <div class="collapsible-header">
                    <h4 class="font-semibold">Option C: Delete and Re-Upload</h4>
                    <span class="text-xl">▼</span>
                  </div>
                  <div class="collapsible-content">
                    <div class="alert-box alert-warning mb-3">
                      <strong>⚠️ Warning:</strong> Permanently deletes original data. Use only if certain.
                    </div>
                    <ol class="list-decimal ml-6 space-y-1 text-sm text-gray-700">
                      <li>Log into JotForm</li>
                      <li>Find and DELETE the existing submission</li>
                      <li>Move the PDF back to <code>incoming/</code></li>
                      <li>Agent will process as new submission</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section id="scenarios" class="content-section mb-12">
            <h2 class="text-3xl font-bold mb-6" style="color: var(--primary)">Common Scenarios</h2>

            <div class="space-y-4">
              <div class="collapsible-section">
                <div class="collapsible-header">
                  <h3 class="text-lg font-semibold">Scenario 1: Legitimate Re-Assessment</h3>
                  <span class="text-xl">▼</span>
                </div>
                <div class="collapsible-content">
                  <p class="text-gray-700 mb-2"><strong>Situation:</strong> Student took assessment again with different answers</p>
                  <p class="text-gray-700 mb-3"><strong>Resolution:</strong></p>
                  <ul class="list-disc ml-6 space-y-1 text-gray-700">
                    <li>If first assessment valid → Keep existing (Option A)</li>
                    <li>If second should replace → Delete old and re-upload (Option C)</li>
                    <li>Document which assessment was kept</li>
                  </ul>
                </div>
              </div>

              <div class="collapsible-section">
                <div class="collapsible-header">
                  <h3 class="text-lg font-semibold">Scenario 2: Wrong Student ID</h3>
                  <span class="text-xl">▼</span>
                </div>
                <div class="collapsible-content">
                  <p class="text-gray-700 mb-2"><strong>Situation:</strong> PDF has wrong student ID</p>
                  <p class="text-gray-700 mb-3"><strong>Resolution:</strong></p>
                  <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                    <li>Correct the student ID in the PDF filename</li>
                    <li>Re-scan with correct ID</li>
                    <li>Upload the corrected PDF</li>
                    <li>Archive incorrect PDF from Unsorted/</li>
                  </ol>
                </div>
              </div>

              <div class="collapsible-section">
                <div class="collapsible-header">
                  <h3 class="text-lg font-semibold">Scenario 3: Data Entry Correction</h3>
                  <span class="text-xl">▼</span>
                </div>
                <div class="collapsible-content">
                  <p class="text-gray-700 mb-2"><strong>Situation:</strong> Field marked incorrectly during assessment</p>
                  <p class="text-gray-700 mb-3"><strong>Resolution:</strong></p>
                  <ul class="list-disc ml-6 space-y-1 text-gray-700">
                    <li>If 1-2 fields → Option B (manual JotForm edit)</li>
                    <li>If many fields → Option C (delete and re-upload)</li>
                    <li>Document the correction in operator log</li>
                  </ul>
                </div>
              </div>
            </div>
          </section>

          <section id="best-practices" class="content-section mb-12">
            <h2 class="text-3xl font-bold mb-6" style="color: var(--primary)">Best Practices</h2>

            <div class="grid md:grid-cols-2 gap-6">
              <div class="diagram-box bg-green-50 border-green-300">
                <h3 class="text-lg font-semibold mb-3">✅ DO:</h3>
                <ul class="space-y-2 text-sm text-gray-700">
                  <li>• Review logs daily for conflicts</li>
                  <li>• Investigate each conflict before action</li>
                  <li>• Document all manual changes</li>
                  <li>• Keep backups of conflicted PDFs</li>
                  <li>• Communicate with administrators</li>
                </ul>
              </div>

              <div class="diagram-box bg-red-50 border-red-300">
                <h3 class="text-lg font-semibold mb-3">❌ DON'T:</h3>
                <ul class="space-y-2 text-sm text-gray-700">
                  <li>• Blindly delete submissions</li>
                  <li>• Ignore conflicts</li>
                  <li>• Disable protection</li>
                  <li>• Re-upload same PDF repeatedly</li>
                </ul>
              </div>
            </div>

            <div class="diagram-box bg-blue-50 border-blue-300 mt-6">
              <h3 class="text-lg font-semibold mb-3">🔍 Prevention Tips</h3>
              <ul class="space-y-2 text-sm text-gray-700">
                <li>✓ <strong>Unique session keys:</strong> Never reuse student ID + date + time</li>
                <li>✓ <strong>Quality control:</strong> Verify PDFs before uploading</li>
                <li>✓ <strong>Training:</strong> Ensure operators understand workflow</li>
                <li>✓ <strong>Communication:</strong> Coordinate with other operators</li>
              </ul>
            </div>
          </section>
        </div>

        <footer class="text-center text-gray-600 text-sm py-8">
          <p><strong>4Set System</strong> - KeySteps@JC (Phase Two)</p>
          <p class="mt-2">The Education University of Hong Kong | Version 1.0 | October 2025</p>
        </footer>
      </main>
    </div>
  </div>

  <script src="assets/js/user-guides.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.querySelectorAll('.collapsible-header span:last-child').forEach(arrow => {
          const content = arrow.closest('.collapsible-header').nextElementSibling;
          arrow.textContent = content.classList.contains('active') ? '▲' : '▼';
          arrow.classList.add('arrow');
        });
      }, 100);
    });
  </script>
</body>
</html>
