<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Detector Test - Browser Compatibility</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Grade Detector Test - Browser Compatibility</h1>
    <p>This page tests the <code>grade-detector-test.js</code> UMD module in a browser environment.</p>
    
    <div id="results"></div>

    <script src="grade-detector-test.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        
        function addResult(testName, passed, details) {
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${passed ? '✅' : '❌'} ${testName}</strong>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            resultsDiv.appendChild(div);
        }

        // Test 1: Check if GradeDetector is available
        addResult(
            'GradeDetector is available on window',
            typeof window.GradeDetector !== 'undefined',
            `window.GradeDetector: ${typeof window.GradeDetector}`
        );

        // Test 2: Check determineGrade function exists
        addResult(
            'determineGrade function exists',
            typeof window.GradeDetector.determineGrade === 'function',
            `typeof GradeDetector.determineGrade: ${typeof window.GradeDetector.determineGrade}`
        );

        // Test 3: Test with Qualtrics recordedDate (K2)
        const test3Result = window.GradeDetector.determineGrade({
            recordedDate: '2024-10-07T05:10:05.400Z'
        });
        addResult(
            'Determine grade from Qualtrics recordedDate (Oct 2024)',
            test3Result === 'K2',
            `Input: recordedDate = "2024-10-07T05:10:05.400Z"\nExpected: K2\nGot: ${test3Result}`
        );

        // Test 4: Test with JotForm sessionkey (K3)
        const test4Result = window.GradeDetector.determineGrade({
            sessionkey: '10261_20251014_10_59'
        });
        addResult(
            'Determine grade from JotForm sessionkey (Oct 2025)',
            test4Result === 'K3',
            `Input: sessionkey = "10261_20251014_10_59"\nExpected: K3\nGot: ${test4Result}`
        );

        // Test 5: Test with K1 recordedDate
        const test5Result = window.GradeDetector.determineGrade({
            recordedDate: '2024-02-15T10:30:00.000Z'
        });
        addResult(
            'Determine grade from recordedDate (Feb 2024 = K1)',
            test5Result === 'K1',
            `Input: recordedDate = "2024-02-15T10:30:00.000Z"\nExpected: K1 (Feb 2024 falls in 2023/24 school year)\nGot: ${test5Result}`
        );

        // Test 6: Test with invalid data
        const test6Result = window.GradeDetector.determineGrade({});
        addResult(
            'Handle missing data gracefully',
            test6Result === 'Unknown',
            `Input: {}\nExpected: Unknown\nGot: ${test6Result}`
        );

        // Test 7: Test determineGradeFromRecordedDate directly
        const test7Result = window.GradeDetector.determineGradeFromRecordedDate('2024-09-01T00:00:00.000Z');
        addResult(
            'determineGradeFromRecordedDate (Sep 2024 = K2)',
            test7Result === 'K2',
            `Input: "2024-09-01T00:00:00.000Z"\nExpected: K2\nGot: ${test7Result}`
        );

        // Test 8: Test determineGradeFromSessionKey directly
        const test8Result = window.GradeDetector.determineGradeFromSessionKey('10001_20230815_09_00');
        addResult(
            'determineGradeFromSessionKey (Aug 2023 = K1)',
            test8Result === 'K1',
            `Input: "10001_20230815_09_00"\nExpected: K1\nGot: ${test8Result}`
        );

        // Test 9: Test hybrid approach (recordedDate takes priority)
        const test9Result = window.GradeDetector.determineGrade({
            recordedDate: '2024-10-01T00:00:00.000Z',
            sessionkey: '10001_20230815_09_00'
        });
        addResult(
            'Hybrid approach - recordedDate takes priority',
            test9Result === 'K2',
            `Input: recordedDate = "2024-10-01T00:00:00.000Z" (K2), sessionkey = "10001_20230815_09_00" (K1)\nExpected: K2 (recordedDate priority)\nGot: ${test9Result}`
        );

        // Test 10: Test getSchoolYear helper
        const test10Result = window.GradeDetector.getSchoolYear('2024-10-01T00:00:00.000Z');
        addResult(
            'getSchoolYear helper function',
            test10Result === 2024,
            `Input: "2024-10-01T00:00:00.000Z"\nExpected: 2024\nGot: ${test10Result}`
        );

        // Summary
        const allTests = document.querySelectorAll('.test-result');
        const passedTests = document.querySelectorAll('.test-result.pass').length;
        const totalTests = allTests.length;
        
        const summary = document.createElement('div');
        summary.style.marginTop = '20px';
        summary.style.padding = '15px';
        summary.style.backgroundColor = passedTests === totalTests ? '#d4edda' : '#fff3cd';
        summary.style.border = `1px solid ${passedTests === totalTests ? '#c3e6cb' : '#ffeeba'}`;
        summary.style.borderRadius = '4px';
        summary.innerHTML = `<strong>Summary: ${passedTests}/${totalTests} tests passed</strong>`;
        resultsDiv.appendChild(summary);
    </script>
</body>
</html>
