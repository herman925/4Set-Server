<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Validator Compatibility Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .method-list {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin-top: 10px;
        }
        .test-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #495057;
        }
    </style>
</head>
<body>
    <h1>üß™ Task Validator Compatibility Test</h1>
    <p>This page tests that the task validator works correctly in a browser environment after the Node.js compatibility fix.</p>
    
    <div id="results"></div>

    <!-- Load the main task validator from production location -->
    <script src="../assets/js/task-validator.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');
        let testsPassed = 0;
        let testsFailed = 0;
        
        function addSection(title) {
            const section = document.createElement('div');
            section.className = 'test-section';
            const titleDiv = document.createElement('div');
            titleDiv.className = 'test-title';
            titleDiv.textContent = title;
            section.appendChild(titleDiv);
            resultsDiv.appendChild(section);
            return section;
        }
        
        function addResult(section, message, isSuccess, details = null) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = message;
            
            if (details) {
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'method-list';
                detailsDiv.textContent = details;
                div.appendChild(detailsDiv);
            }
            
            section.appendChild(div);
            
            if (isSuccess) {
                testsPassed++;
            } else {
                testsFailed++;
            }
        }
        
        function addInfo(section, message) {
            const div = document.createElement('div');
            div.className = 'test-result info';
            div.innerHTML = message;
            section.appendChild(div);
        }
        
        // Test 1: Check if TaskValidator is available on window
        const section1 = addSection('Test 1: Global Availability');
        if (typeof window.TaskValidator !== 'undefined') {
            addResult(section1, '‚úÖ TaskValidator is available on window object', true);
        } else {
            addResult(section1, '‚ùå TaskValidator is NOT available on window object', false);
        }
        
        // Test 2: Check if it has the expected methods
        const section2 = addSection('Test 2: Method Availability');
        const expectedMethods = ['loadTaskDefinition', 'validateTask', 'validateAllTasks', 'extractQuestions'];
        const availableMethods = typeof window.TaskValidator === 'object' ? Object.keys(window.TaskValidator) : [];
        
        const hasAllMethods = expectedMethods.every(method => availableMethods.includes(method));
        if (hasAllMethods) {
            addResult(section2, '‚úÖ All expected methods are available', true, 
                     'Expected: ' + expectedMethods.join(', '));
        } else {
            const missing = expectedMethods.filter(method => !availableMethods.includes(method));
            addResult(section2, '‚ùå Some methods are missing: ' + missing.join(', '), false,
                     'Available: ' + availableMethods.join(', '));
        }
        
        // Test 3: Verify TaskValidator is a proper object
        const section3 = addSection('Test 3: Type Validation');
        if (typeof window.TaskValidator === 'object' && window.TaskValidator !== null) {
            addResult(section3, '‚úÖ TaskValidator is properly exposed as an object', true);
        } else {
            addResult(section3, '‚ùå TaskValidator is not a proper object (type: ' + typeof window.TaskValidator + ')', false);
        }
        
        // Test 4: Check if methods are functions
        const section4 = addSection('Test 4: Method Type Validation');
        let allMethodsAreFunctions = true;
        const methodTypes = [];
        
        expectedMethods.forEach(method => {
            const isFunction = typeof window.TaskValidator[method] === 'function';
            methodTypes.push(`${method}: ${typeof window.TaskValidator[method]}`);
            if (!isFunction) {
                allMethodsAreFunctions = false;
            }
        });
        
        if (allMethodsAreFunctions) {
            addResult(section4, '‚úÖ All methods are properly defined as functions', true, 
                     methodTypes.join('\n'));
        } else {
            addResult(section4, '‚ùå Some methods are not functions', false,
                     methodTypes.join('\n'));
        }
        
        // Test 5: Backward compatibility check
        const section5 = addSection('Test 5: Backward Compatibility');
        addInfo(section5, 'üìù This test confirms the fix maintains backward compatibility with existing code that expects window.TaskValidator');
        
        if (typeof window.TaskValidator !== 'undefined' && 
            typeof window.TaskValidator.validateAllTasks === 'function') {
            addResult(section5, '‚úÖ Backward compatibility maintained - existing code will work without changes', true);
        } else {
            addResult(section5, '‚ùå Backward compatibility broken - existing code may fail', false);
        }
        
        // Summary
        const summary = addSection('üìä Test Summary');
        const totalTests = testsPassed + testsFailed;
        
        if (testsFailed === 0) {
            addResult(summary, 
                     `üéâ All tests passed! (${testsPassed}/${totalTests})<br>` +
                     `The task validator is fully compatible with browser environments and maintains backward compatibility.`,
                     true);
        } else {
            addResult(summary, 
                     `‚ö†Ô∏è Some tests failed: ${testsPassed}/${totalTests} passed<br>` +
                     `Please review the failures above.`,
                     false);
        }
        
        // Add Node.js compatibility note
        addInfo(summary, 
               'üì¶ <strong>Node.js Compatibility:</strong> This fix also enables the task validator to be used in Node.js environments ' +
               'using <code>require()</code> or <code>import</code>, which was the original issue that prompted this fix.');
    </script>
</body>
</html>
